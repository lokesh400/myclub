<div class="max-w-5xl mx-auto mt-10 p-6 bg-white rounded-lg shadow-lg">
  <h2 class="text-3xl font-bold mb-6 text-indigo-600">
    All Recruitments for <%= registrations[0] ? registrations[0].clubId.name : '' %>
  </h2>

  <%- include('../flash.ejs') %>

  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-indigo-100 text-left">
        <tr>
          <th class="px-6 py-3 text-gray-700 font-semibold">Created By</th>
          <th class="px-6 py-3 text-gray-700 font-semibold">Year</th>
          <th class="px-6 py-3 text-gray-700 font-semibold">Created At</th>
          <th class="px-6 py-3 text-gray-700 font-semibold">Applicants</th>
          <th class="px-6 py-3 text-gray-700 font-semibold">Share</th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        <% if (registrations.length === 0) { %>
          <tr>
            <td colspan="5" class="px-6 py-4 text-center text-gray-500">No registrations yet.</td>
          </tr>
        <% } else { %>
          <% registrations.forEach((reg, index) => { %>
            <tr class="hover:bg-gray-50 transition">
              <td class="px-6 py-3 font-medium text-gray-800"><%= reg.userId.username %></td>
              <td class="px-6 py-3 text-gray-700"><%= reg.year %></td>
              <td class="px-6 py-3 text-gray-700"><%= new Date(reg.createdAt).toLocaleString() %></td>
              <td class="px-6 py-3">
                <a href="/club/this/recruitment/<%= reg._id %>" 
                   class="text-indigo-600 hover:underline font-medium">
                  View Applicants
                </a>
              </td>
              <td class="px-6 py-3">
                <button class="shareBtn bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 transition"
                        data-link="<%= baseUrl %>/student/register/<%= reg._id %>">
                  Share
                </button>
              </td>
            </tr>
          <% }) %>
        <% } %>
      </tbody>
    </table>
  </div>
</div>

<script>
  document.querySelectorAll('.shareBtn').forEach(btn => {
    btn.addEventListener('click', async () => {
      const link = btn.getAttribute('data-link');

      if (navigator.share) {
        // Use native share if available
        try {
          await navigator.share({
            title: 'Student Registration',
            text: 'Register for this recruitment',
            url: link
          });
        } catch (err) {
          console.error('Share failed:', err);
        }
      } else {
        // Fallback: copy to clipboard
        try {
          await navigator.clipboard.writeText(link);
          btn.textContent = 'Copied!';
          setTimeout(() => btn.textContent = 'Share', 2000);
        } catch (err) {
          console.error('Copy failed:', err);
          alert('Copy failed. Please copy manually: ' + link);
        }
      }
    });
  });
</script>
