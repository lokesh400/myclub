  <div class="max-w-5xl mx-auto bg-white p-6 shadow rounded mt-8">
    <h1 class="text-3xl font-bold mb-6">Form Submissions</h1>

    <div class="flex justify-between mb-4">
      <input type="text" id="searchInput" placeholder="Search by Roll Number"
             class="border p-2 rounded w-1/3">
      <button id="downloadBtn"
              class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
        Download Excel
      </button>
    </div>

    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200" id="submissionsTable">
        <thead class="bg-gray-100">
          <tr>
            <th class="px-6 py-3 font-semibold">Name</th>
            <th class="px-6 py-3 font-semibold">Roll Number</th>
            <th class="px-6 py-3 font-semibold">Department</th>
            <th class="px-6 py-3 font-semibold">Branch</th>
            <th class="px-6 py-3 font-semibold">Semester</th>
            <th class="px-6 py-3 font-semibold">Attendance</th>
            <th class="px-6 py-3 font-semibold">Submitted At</th>
          </tr>
        </thead>
        <tbody id="tableBody" class="bg-white divide-y divide-gray-200">
          <% submissions.forEach(sub => { %>
            <tr data-id="<%= sub._id %>" class="<%= sub.attendance ? 'bg-green-100' : '' %>">
              <td class="px-6 py-3"><%= sub.data.Name %></td>
              <td class="px-6 py-3"><%= sub.data['Roll Number'] %></td>
              <td class="px-6 py-3"><%= sub.data.Department %></td>
              <td class="px-6 py-3"><%= sub.data.Branch %></td>
              <td class="px-6 py-3"><%= sub.data.Semester %></td>
              <td class="px-6 py-3 text-center">
                <span class="attendanceText"><%= sub.attendance ? 'Present' : 'Absent' %></span>
                <input type="checkbox" class="attendanceCheckbox" <%= sub.attendance ? 'checked' : '' %>>
              </td>
              <td class="px-6 py-3"><%= new Date(sub.createdAt).toLocaleString() %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  </div>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
  const socket = io();
  const tableBody = document.getElementById('tableBody');
  const searchInput = document.getElementById('searchInput');

  searchInput.addEventListener('input', () => {
    const value = searchInput.value.toLowerCase();
    for (let row of tableBody.rows) {
      const rollCell = row.cells[1].textContent.toLowerCase();
      row.style.display = rollCell.includes(value) ? '' : 'none';
    }
  });

  tableBody.addEventListener('change', e => {
    if (!e.target.classList.contains('attendanceCheckbox')) return;
    const row = e.target.closest('tr');
    const checked = e.target.checked;
    row.classList.toggle('bg-green-100', checked);
    const span = row.querySelector('.attendanceText');
    span.textContent = checked ? 'Present' : 'Absent';
    socket.emit('updateAttendance', {
      submissionId: row.dataset.id,
      attendance: checked
    });
  });
  document.getElementById('downloadBtn').addEventListener('click', () => {
    const table = document.getElementById('submissionsTable');
    table.querySelectorAll('.attendanceCheckbox').forEach(checkbox => {
      const span = checkbox.closest('td').querySelector('.attendanceText');
      span.textContent = checkbox.checked ? 'Present' : 'Absent';
    });
    const wb = XLSX.utils.table_to_book(table, { sheet: "Submissions" });
    XLSX.writeFile(wb, "form_submissions.xlsx");
  });
</script>